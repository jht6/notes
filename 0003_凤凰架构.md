# 摘抄

# 笔记

### 单体架构的优缺点

优点：
- 适合小规模项目，开发、部署、测试便捷
- 无需进程间通信（IPC），性能高

缺点：
- 出问题时影响难以隔离，整个程序都受影响
- 无法单独停止、升级某部分代码
- 更新需停机计划，做灰度发布，AB测试也更复杂
- 难以技术异构，即使用不同框架、语言开发整个服务的不同模块

### SOA和SOAP的失败

SOA理想宏大，其终极目标是总结出一套方法论来指导解决软件开发的全部问题，但SOA和SOAP的问题在于：它们太复杂了。这导致了其最终的失败。

### 微服务

核心概念：微服务是一种通过多个小型服务组合来构建单个应用的架构风格，这些服务围绕业务能力而非特定的技术标准来构建。

还有专门的申明：微服务不是SOA的变体或衍生品。这将微服务与SOA彻底划清了界限。

特性： 

- 围绕业务能力构建：康威定律，公司组织架构影响技术架构

- 分散治理：服务对应的开发团队直接掌控该服务并负责，不同服务之间可以技术异构。

- 通过服务实现独立自治的组件：用服务而非类库。服务之间通过远程调用来提供功能。

- 数据去中心化：数据分散管理。

- 容错性设计：不再虚幻地追求服务永远稳定，接受服务会出错的现实，并在架构设计中加入容错机制。

- 演进式设计：承认服务会被报废淘汰，可灵活替换新服务。

- 基础设施自动化：如CI/CD减少构建、发布、运维工作的复杂性。

## 事务原子性、持久性的实现

问题：“写入磁盘”这个操作不是原子的，存在多种状态：已写入、未写入、正在写。
因此，需要使用“崩溃恢复”机制解决这个问题。

### 提交日志 Commiting Logging
把修改操作的全部信息先写入Redo日志，当日志写入完成后，才开始真正修改数据。

方案缺陷：所有对数据的真实修改必须发生在事务提交之后，性能差。

### 提前写入日志 Write-Ahead Logging

根据事务提交、何时写入变动数据，划分为两类情况：
- FORCE: 事务提交后，变动数据必须同时完成写入，称为FORCE。不强制必须同时写入则为NO-FORCE。
- STEAL：事务提交前，允许变动数据提前写入，称为STEAL。不允许则称为NO-STEAL。

Writing-Ahead Logging 允许NO-FORCE，也允许STEAL，它增加了Undo日志，在变动数据写入磁盘前，必须先记录Undo日志，以便回滚时使用。